<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dashboard Bendahara - PPDB SMK</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        body { background: #f4f6f9; }
        .stat-card { text-align: center; padding: 20px; border-radius: 10px; color: white; margin-bottom: 20px; }
        .stat-total { background: #6c757d; }
        .stat-terdaftar { background: #ffc107; color: black; }
        .stat-diterima { background: #28a745; }
        .stat-daftar-ulang { background: #17a2b8; }
        .stat-ditolak { background: #dc3545; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="card shadow">
            <div class="card-header bg-success text-white text-center">
                <h3>DASHBOARD BENDAHARA</h3>
                <p>PPDB SMK - Tahun Ajaran 2026/2027</p>
                <a href="{% url 'admin:logout' %}" class="btn btn-light btn-sm float-end">Logout</a>
            </div>
            <div class="text-end mb-3">
                    <a href="{% url 'rekap_daftar_ulang' %}" class="btn btn-info">üìä Rekap Daftar Ulang & Pembayaran</a>
            </div>
            <div class="card-body">
                {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-success alert-dismissible fade show">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    {% endfor %}
                {% endif %}

                <!-- Statistik -->
                <div class="row">
                    <div class="col-md-2">
                        <div class="stat-card stat-total shadow">
                            <h4>{{ total }}</h4>
                            <p>Total Pendaftar</p>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="stat-card stat-terdaftar shadow">
                            <h4>{{ terdaftar }}</h4>
                            <p>Terdaftar</p>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="stat-card stat-diterima shadow">
                            <h4>{{ diterima }}</h4>
                            <p>Diterima</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card stat-daftar-ulang shadow">
                            <h4>{{ daftar_ulang }}</h4>
                            <p>Daftar Ulang</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card stat-ditolak shadow">
                            <h4>{{ ditolak }}</h4>
                            <p>Ditolak</p>
                        </div>
                    </div>
                </div>

                <!-- Tabel Pendaftar -->
                <h4 class="mt-4 mb-3">Daftar Seluruh Pendaftar</h4>
                <div class="table-responsive">
                    <table class="table table-striped table-hover align-middle">
                        <thead class="table-dark">
                            <tr>
                                <th>No</th>
                                <th>Nomor Pendaftaran</th>
                                <th>Nama</th>
                                <th>Jurusan</th>
                                <th>Jalur</th>
                                <th>Status</th>
                                <th>Nominal Bayar</th>
                                <th>Tgl Bayar</th>
                                <th>No WA</th>
                                <th>Tanggal Daftar</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for p in pendaftarans %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td><strong>{{ p.nomor_pendaftaran }}</strong></td>
                                <td>{{ p.nama_lengkap }}</td>
                                <td>{{ p.get_jurusan_display }}</td>
                                <td>{{ p.get_jalur_display }}</td>
                                <td>
                                    <span class="badge {% if p.status == 'daftar_ulang' %}bg-info{% elif p.status == 'diterima' %}bg-success{% elif p.status == 'ditolak' %}bg-danger{% else %}bg-warning{% endif %}">
                                        {{ p.get_status_display }}
                                    </span>
                                </td>
                                <td>Rp {{ p.nominal_pembayaran }}</td>
                                <td>{{ p.tanggal_pembayaran|date:"d/m/Y"|default:"Belum" }}</td>
                                <td>{{ p.no_wa }}</td>
                                <td>{{ p.tanggal_pendaftaran|date:"d/m/Y H:i" }}</td>
                                <td>
                                    <a href="{% url 'print_kartu' p.pk %}" target="_blank" class="btn btn-sm btn-primary me-2">üñ®Ô∏è Print</a>
                                    
                                    <!-- Tombol Ubah Status -->
                                    <button type="button" class="btn btn-sm btn-warning me-2" data-bs-toggle="modal" data-bs-target="#modalStatus{{ p.pk }}">
                                        Ubah Status
                                    </button>
                                    
                                    <!-- Tombol Input Pembayaran -->
                                    <button type="button" class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#modalBayar{{ p.pk }}">
                                        Input Bayar
                                    </button>
                                    
                                    <!-- Modal Ubah Status (sama kayak kemarin) -->
                                    <div class="modal fade" id="modalStatus{{ p.pk }}" tabindex="-1">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header bg-warning text-dark">
                                                    <h5 class="modal-title">Ubah Status Pendaftaran</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                                </div>
                                                <form method="post" action="{% url 'ubah_status_daftar_ulang' p.pk %}">
                                                    {% csrf_token %}
                                                    <div class="modal-body">
                                                        <p><strong>Nama:</strong> {{ p.nama_lengkap }}</p>
                                                        <p><strong>Nomor:</strong> {{ p.nomor_pendaftaran }}</p>
                                                        <p><strong>Status Saat Ini:</strong> {{ p.get_status_display }}</p>
                                                        
                                                        <label class="form-label mt-3">Pilih Status Baru:</label>
                                                        <select name="status" class="form-control" required>
                                                            <option value="terdaftar" {% if p.status == 'terdaftar' %}selected{% endif %}>Terdaftar</option>
                                                            <option value="diterima" {% if p.status == 'diterima' %}selected{% endif %}>Diterima</option>
                                                            <option value="daftar_ulang" {% if p.status == 'daftar_ulang' %}selected{% endif %}>Daftar Ulang</option>
                                                            <option value="ditolak" {% if p.status == 'ditolak' %}selected{% endif %}>Ditolak</option>
                                                        </select>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                                                        <button type="submit" class="btn btn-success">Simpan Perubahan</button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Modal Input Pembayaran -->
                                    <div class="modal fade" id="modalBayar{{ p.pk }}" tabindex="-1">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header bg-success text-white">
                                                    <h5 class="modal-title">Input Pembayaran - {{ p.nama_lengkap }}</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                                </div>
                                                <form method="post" action="{% url 'input_pembayaran' p.pk %}">
                                                    {% csrf_token %}
                                                    <div class="modal-body">
                                                        <p><strong>Nomor:</strong> {{ p.nomor_pendaftaran }}</p>
                                                        <p><strong>Sudah Bayar:</strong> Rp {{ p.nominal_pembayaran }}</p>
                                                        
                                                        <label class="form-label mt-3">Nominal Pembayaran Baru (Rp)</label>
                                                        <input type="number" name="nominal_pembayaran" class="form-control" placeholder="Contoh: 500000" required>
                                                        
                                                        <label class="form-label mt-3">Tanggal Pembayaran</label>
                                                        <input type="date" name="tanggal_pembayaran" class="form-control" value="{{ today|date:'Y-m-d' }}">
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                                                        <button type="submit" class="btn btn-success">Simpan Pembayaran</button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            {% empty %}
                            <tr><td colspan="11" class="text-center">Belum ada pendaftar</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card-footer text-center text-muted">
                Dashboard Khusus Bendahara - Akses terbatas
            </div>
        </div>
    </div>
</body>
</html>